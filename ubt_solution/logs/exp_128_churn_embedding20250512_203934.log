INFO:__main__:Using custom task weights: {'churn': 1.0, 'category_propensity': 0.0, 'product_propensity': 1.0}
INFO:ubt_solution.config:Using CUDA version: 11.8
INFO:ubt_solution.data_processor:内存使用情况 [初始化数据集开始] - RSS: 547.68 MB, VMS: 23751.61 MB
INFO:ubt_solution.data_processor:正在加载相关用户ID，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/input/relevant_clients.npy
INFO:ubt_solution.data_processor:测试模式：只处理前 10000 个用户
INFO:ubt_solution.data_processor:系统可用内存: 334.63 GB
INFO:ubt_solution.data_processor:根据系统内存自动设置块大小为: 20000
INFO:ubt_solution.data_processor:将用户分成 1 个块进行处理，每块大约 20000 个用户
INFO:ubt_solution.data_processor:内存使用情况 [开始分块加载事件数据] - RSS: 555.38 MB, VMS: 23759.24 MB
INFO:ubt_solution.data_processor:处理用户块 1/1
INFO:ubt_solution.data_processor:开始并行加载当前块的事件数据...
INFO:ubt_solution.data_processor:正在加载 product_buy 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/product_buy.parquet
INFO:ubt_solution.data_processor:正在加载 add_to_cart 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/add_to_cart.parquet
INFO:ubt_solution.data_processor:正在加载 remove_from_cart 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/remove_from_cart.parquet
INFO:ubt_solution.data_processor:正在加载 page_visit 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/page_visit.parquet
INFO:ubt_solution.data_processor:正在加载 search_query 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/search_query.parquet
INFO:ubt_solution.data_processor:remove_from_cart 数据加载完成，形状: (39490, 4)
INFO:ubt_solution.data_processor:product_buy 数据加载完成，形状: (44985, 4)
INFO:ubt_solution.data_processor:add_to_cart 数据加载完成，形状: (87008, 4)
INFO:ubt_solution.data_processor:search_query 数据加载完成，形状: (156434, 5)
INFO:ubt_solution.data_processor:page_visit 数据加载完成，形状: (1213783, 4)
INFO:ubt_solution.data_processor:内存使用情况 [块 1 事件数据加载完成] - RSS: 1379.04 MB, VMS: 26546.09 MB
INFO:ubt_solution.data_processor:开始加载商品属性数据...
INFO:ubt_solution.data_processor:正在加载商品属性数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/product_properties.parquet
INFO:ubt_solution.data_processor:商品属性数据加载完成，形状: (1197634, 4)
INFO:ubt_solution.data_processor:商品属性数据加载完成
INFO:ubt_solution.data_processor:开始构建用户块 1 的序列...
INFO:ubt_solution.data_processor:开始构建用户序列...
INFO:ubt_solution.data_processor:内存使用情况 [开始构建用户序列] - RSS: 1579.58 MB, VMS: 26720.94 MB
INFO:ubt_solution.data_processor:找到缓存文件 /data/mhwang/Rec/RecSys/recsys2025/ubt_solution/ubt_solution/cache/user_sequences_479641934112442117.pkl，尝试加载...
INFO:ubt_solution.data_processor:成功从缓存加载 10000 个用户序列
INFO:ubt_solution.data_processor:块 1 处理完成，耗时: 96.47 秒
INFO:ubt_solution.data_processor:内存使用情况 [块 1 处理完成] - RSS: 1794.00 MB, VMS: 26932.94 MB
INFO:ubt_solution.data_processor:用户序列构建完成，共 10000 个用户
INFO:ubt_solution.data_processor:创建商品属性查找字典...
INFO:ubt_solution.data_processor:商品属性字典创建完成，包含 1197634 个商品
INFO:ubt_solution.data_processor:设置样本缓存大小为 5000
INFO:ubt_solution.data_processor:内存使用情况 [数据集初始化完成] - RSS: 2163.24 MB, VMS: 27287.89 MB
INFO:ubt_solution.data_processor:内存使用情况 [初始化数据集开始] - RSS: 2163.24 MB, VMS: 27287.89 MB
INFO:ubt_solution.data_processor:正在加载相关用户ID，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/input/relevant_clients.npy
INFO:ubt_solution.data_processor:测试模式：只处理前 10000 个用户
INFO:ubt_solution.data_processor:系统可用内存: 333.06 GB
INFO:ubt_solution.data_processor:根据系统内存自动设置块大小为: 20000
INFO:ubt_solution.data_processor:将用户分成 1 个块进行处理，每块大约 20000 个用户
INFO:ubt_solution.data_processor:内存使用情况 [开始分块加载事件数据] - RSS: 2170.70 MB, VMS: 27295.52 MB
INFO:ubt_solution.data_processor:处理用户块 1/1
INFO:ubt_solution.data_processor:开始并行加载当前块的事件数据...
INFO:ubt_solution.data_processor:正在加载 product_buy 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/product_buy.parquet
INFO:ubt_solution.data_processor:正在加载 add_to_cart 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/add_to_cart.parquet
INFO:ubt_solution.data_processor:正在加载 remove_from_cart 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/remove_from_cart.parquet
INFO:ubt_solution.data_processor:正在加载 page_visit 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/page_visit.parquet
INFO:ubt_solution.data_processor:正在加载 search_query 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/search_query.parquet
INFO:ubt_solution.data_processor:remove_from_cart 数据加载完成，形状: (39490, 4)
INFO:ubt_solution.data_processor:product_buy 数据加载完成，形状: (44985, 4)
INFO:ubt_solution.data_processor:add_to_cart 数据加载完成，形状: (87008, 4)
INFO:ubt_solution.data_processor:search_query 数据加载完成，形状: (156434, 5)
INFO:ubt_solution.data_processor:page_visit 数据加载完成，形状: (1213783, 4)
INFO:ubt_solution.data_processor:内存使用情况 [块 1 事件数据加载完成] - RSS: 2433.34 MB, VMS: 27932.55 MB
INFO:ubt_solution.data_processor:开始加载商品属性数据...
INFO:ubt_solution.data_processor:正在加载商品属性数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/product_properties.parquet
INFO:ubt_solution.data_processor:商品属性数据加载完成，形状: (1197634, 4)
INFO:ubt_solution.data_processor:商品属性数据加载完成
INFO:ubt_solution.data_processor:开始构建用户块 1 的序列...
INFO:ubt_solution.data_processor:开始构建用户序列...
INFO:ubt_solution.data_processor:内存使用情况 [开始构建用户序列] - RSS: 2607.67 MB, VMS: 28119.21 MB
INFO:ubt_solution.data_processor:找到缓存文件 /data/mhwang/Rec/RecSys/recsys2025/ubt_solution/ubt_solution/cache/user_sequences_479641934112442117.pkl，尝试加载...
INFO:ubt_solution.data_processor:成功从缓存加载 10000 个用户序列
INFO:ubt_solution.data_processor:块 1 处理完成，耗时: 92.20 秒
INFO:ubt_solution.data_processor:内存使用情况 [块 1 处理完成] - RSS: 2824.02 MB, VMS: 28327.21 MB
INFO:ubt_solution.data_processor:用户序列构建完成，共 10000 个用户
INFO:ubt_solution.data_processor:创建商品属性查找字典...
INFO:ubt_solution.data_processor:商品属性字典创建完成，包含 1197634 个商品
INFO:ubt_solution.data_processor:设置样本缓存大小为 5000
INFO:ubt_solution.data_processor:内存使用情况 [数据集初始化完成] - RSS: 3246.97 MB, VMS: 28707.48 MB
/data_sdc/mhwang/miniconda3/envs/RecSys/lib/python3.11/site-packages/torch/nn/modules/transformer.py:379: UserWarning: enable_nested_tensor is True, but self.use_nested_tensor is False because encoder_layer.norm_first was True
  warnings.warn(
/data_sdc/mhwang/miniconda3/envs/RecSys/lib/python3.11/site-packages/torch/optim/lr_scheduler.py:62: UserWarning: The verbose parameter is deprecated. Please use get_last_lr() to access the learning rate.
  warnings.warn(
INFO:__main__:开始训练模型...
INFO:ubt_solution.trainer:Epoch 1/10
Training:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.trainer:Batch 0: 开始训练
INFO:ubt_solution.trainer:Batch 0: 品类倾向性标签比例 = 21.97%
INFO:ubt_solution.trainer:Batch 0: 产品倾向性标签比例 = 2.49%
INFO:ubt_solution.model:品类倾向性: 450/2048 样本有标签 (21.97%)
INFO:ubt_solution.model:产品倾向性: 51/2048 样本有标签 (2.49%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3870489597320557
Training:  20%|██        | 1/5 [00:27<01:49, 27.30s/it]INFO:ubt_solution.trainer:Batch 1: 开始训练
INFO:ubt_solution.model:品类倾向性: 431/2048 样本有标签 (21.04%)
INFO:ubt_solution.model:产品倾向性: 57/2048 样本有标签 (2.78%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.385679006576538
Training:  40%|████      | 2/5 [00:38<00:54, 18.05s/it]INFO:ubt_solution.trainer:Batch 2: 开始训练
INFO:ubt_solution.model:品类倾向性: 432/2048 样本有标签 (21.09%)
INFO:ubt_solution.model:产品倾向性: 56/2048 样本有标签 (2.73%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.384063959121704
Training:  60%|██████    | 3/5 [00:50<00:30, 15.07s/it]INFO:ubt_solution.trainer:Batch 3: 开始训练
INFO:ubt_solution.model:品类倾向性: 458/2048 样本有标签 (22.36%)
INFO:ubt_solution.model:产品倾向性: 57/2048 样本有标签 (2.78%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.382753610610962
Training:  80%|████████  | 4/5 [01:02<00:13, 13.71s/it]INFO:ubt_solution.trainer:Batch 4: 开始训练
INFO:ubt_solution.model:品类倾向性: 385/1808 样本有标签 (21.29%)
INFO:ubt_solution.model:产品倾向性: 43/1808 样本有标签 (2.38%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3811230659484863
Training: 100%|██████████| 5/5 [01:11<00:00, 12.17s/it]Training: 100%|██████████| 5/5 [01:11<00:00, 14.32s/it]
INFO:ubt_solution.trainer:total_loss: 13842.059761047363, total_samples: 10000
INFO:ubt_solution.trainer:Epoch average loss: 1.3842
INFO:ubt_solution.trainer:训练集 category_propensity 标签比例: 21.56%
INFO:ubt_solution.trainer:训练集 product_propensity 标签比例: 2.64%
INFO:ubt_solution.trainer:Epoch average churn_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average category_propensity_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average product_propensity_loss: 0.0000
Validation:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.model:品类倾向性: 580/2048 样本有标签 (28.32%)
INFO:ubt_solution.model:产品倾向性: 72/2048 样本有标签 (3.52%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  20%|██        | 1/5 [00:18<01:12, 18.04s/it]INFO:ubt_solution.model:品类倾向性: 605/2048 样本有标签 (29.54%)
INFO:ubt_solution.model:产品倾向性: 80/2048 样本有标签 (3.91%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  40%|████      | 2/5 [00:20<00:26,  8.97s/it]INFO:ubt_solution.model:品类倾向性: 423/2048 样本有标签 (20.65%)
INFO:ubt_solution.model:产品倾向性: 55/2048 样本有标签 (2.69%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  60%|██████    | 3/5 [00:22<00:11,  5.79s/it]INFO:ubt_solution.model:品类倾向性: 284/2048 样本有标签 (13.87%)
INFO:ubt_solution.model:产品倾向性: 22/2048 样本有标签 (1.07%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  80%|████████  | 4/5 [00:24<00:04,  4.08s/it]INFO:ubt_solution.model:品类倾向性: 264/1808 样本有标签 (14.60%)
INFO:ubt_solution.model:产品倾向性: 35/1808 样本有标签 (1.94%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation: 100%|██████████| 5/5 [00:25<00:00,  3.08s/it]Validation: 100%|██████████| 5/5 [00:25<00:00,  5.12s/it]
INFO:ubt_solution.trainer:churn_loss improved: 0.0000
INFO:ubt_solution.trainer:category_propensity_loss improved: 0.0000
INFO:ubt_solution.trainer:product_propensity_loss improved: 0.0000
INFO:ubt_solution.trainer:New best churn_auc: 0.6268
INFO:ubt_solution.trainer:New best category_propensity_accuracy: 0.5368
INFO:ubt_solution.trainer:New best product_propensity_accuracy: 0.9819
INFO:ubt_solution.trainer:保存最佳模型，验证损失: 1.3778
INFO:ubt_solution.trainer:Validation metrics: {'val_loss': 1.3777617000579834, 'churn_loss': 0.0, 'category_propensity_loss': 0.0, 'product_propensity_loss': 0.0, 'churn_auc': 0.6268494129180908, 'category_propensity_accuracy': 0.5367950201034546, 'category_propensity_pos_accuracy': 0.5367950201034546, 'product_propensity_accuracy': 0.9819318056106567, 'product_propensity_pos_accuracy': 0.9819318056106567}
INFO:ubt_solution.trainer:category_propensity 标签比例: 当前=21.56%, 平均=21.56%
INFO:ubt_solution.trainer:product_propensity 标签比例: 当前=2.64%, 平均=2.64%
INFO:ubt_solution.trainer:Epoch 2/10
Training:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.trainer:Batch 0: 开始训练
INFO:ubt_solution.trainer:Batch 0: 品类倾向性标签比例 = 20.46%
INFO:ubt_solution.trainer:Batch 0: 产品倾向性标签比例 = 2.69%
INFO:ubt_solution.model:品类倾向性: 419/2048 样本有标签 (20.46%)
INFO:ubt_solution.model:产品倾向性: 55/2048 样本有标签 (2.69%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3797264099121094
Training:  20%|██        | 1/5 [00:26<01:46, 26.53s/it]INFO:ubt_solution.trainer:Batch 1: 开始训练
INFO:ubt_solution.model:品类倾向性: 457/2048 样本有标签 (22.31%)
INFO:ubt_solution.model:产品倾向性: 57/2048 样本有标签 (2.78%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3782339096069336
Training:  40%|████      | 2/5 [00:37<00:51, 17.19s/it]INFO:ubt_solution.trainer:Batch 2: 开始训练
INFO:ubt_solution.model:品类倾向性: 437/2048 样本有标签 (21.34%)
INFO:ubt_solution.model:产品倾向性: 56/2048 样本有标签 (2.73%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3764455318450928
Training:  60%|██████    | 3/5 [00:47<00:28, 14.24s/it]INFO:ubt_solution.trainer:Batch 3: 开始训练
INFO:ubt_solution.model:品类倾向性: 471/2048 样本有标签 (23.00%)
INFO:ubt_solution.model:产品倾向性: 49/2048 样本有标签 (2.39%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3752622604370117
Training:  80%|████████  | 4/5 [01:01<00:13, 13.94s/it]INFO:ubt_solution.trainer:Batch 4: 开始训练
INFO:ubt_solution.model:品类倾向性: 372/1808 样本有标签 (20.58%)
INFO:ubt_solution.model:产品倾向性: 47/1808 样本有标签 (2.60%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3733998537063599
Training: 100%|██████████| 5/5 [01:10<00:00, 12.08s/it]Training: 100%|██████████| 5/5 [01:10<00:00, 14.08s/it]
INFO:ubt_solution.trainer:total_loss: 13766.907228469849, total_samples: 10000
INFO:ubt_solution.trainer:Epoch average loss: 1.3767
INFO:ubt_solution.trainer:训练集 category_propensity 标签比例: 21.56%
INFO:ubt_solution.trainer:训练集 product_propensity 标签比例: 2.64%
INFO:ubt_solution.trainer:Epoch average churn_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average category_propensity_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average product_propensity_loss: 0.0000
Validation:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.model:品类倾向性: 580/2048 样本有标签 (28.32%)
INFO:ubt_solution.model:产品倾向性: 72/2048 样本有标签 (3.52%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  20%|██        | 1/5 [00:19<01:16, 19.14s/it]INFO:ubt_solution.model:品类倾向性: 605/2048 样本有标签 (29.54%)
INFO:ubt_solution.model:产品倾向性: 80/2048 样本有标签 (3.91%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  40%|████      | 2/5 [00:22<00:28,  9.56s/it]INFO:ubt_solution.model:品类倾向性: 423/2048 样本有标签 (20.65%)
INFO:ubt_solution.model:产品倾向性: 55/2048 样本有标签 (2.69%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  60%|██████    | 3/5 [00:23<00:12,  6.10s/it]INFO:ubt_solution.model:品类倾向性: 284/2048 样本有标签 (13.87%)
INFO:ubt_solution.model:产品倾向性: 22/2048 样本有标签 (1.07%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  80%|████████  | 4/5 [00:25<00:04,  4.27s/it]INFO:ubt_solution.model:品类倾向性: 264/1808 样本有标签 (14.60%)
INFO:ubt_solution.model:产品倾向性: 35/1808 样本有标签 (1.94%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation: 100%|██████████| 5/5 [00:26<00:00,  3.20s/it]Validation: 100%|██████████| 5/5 [00:26<00:00,  5.37s/it]
INFO:ubt_solution.trainer:churn_loss no improvement for 1 epochs
INFO:ubt_solution.trainer:category_propensity_loss no improvement for 1 epochs
INFO:ubt_solution.trainer:product_propensity_loss no improvement for 1 epochs
INFO:ubt_solution.trainer:New best churn_auc: 0.6473
INFO:ubt_solution.trainer:New best product_propensity_accuracy: 0.9862
INFO:ubt_solution.trainer:保存最佳模型，验证损失: 1.3678
INFO:ubt_solution.trainer:Validation metrics: {'val_loss': 1.3678115098953247, 'churn_loss': 0.0, 'category_propensity_loss': 0.0, 'product_propensity_loss': 0.0, 'churn_auc': 0.6473485827445984, 'category_propensity_accuracy': 0.5361874103546143, 'category_propensity_pos_accuracy': 0.5361874103546143, 'product_propensity_accuracy': 0.9862499833106995, 'product_propensity_pos_accuracy': 0.9862499833106995}
INFO:ubt_solution.trainer:category_propensity 标签比例: 当前=21.56%, 平均=21.56%
INFO:ubt_solution.trainer:product_propensity 标签比例: 当前=2.64%, 平均=2.64%
INFO:ubt_solution.trainer:Epoch 3/10
Training:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.trainer:Batch 0: 开始训练
INFO:ubt_solution.trainer:Batch 0: 品类倾向性标签比例 = 22.22%
INFO:ubt_solution.trainer:Batch 0: 产品倾向性标签比例 = 2.34%
INFO:ubt_solution.model:品类倾向性: 455/2048 样本有标签 (22.22%)
INFO:ubt_solution.model:产品倾向性: 48/2048 样本有标签 (2.34%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3717710971832275
Training:  20%|██        | 1/5 [00:22<01:29, 22.28s/it]INFO:ubt_solution.trainer:Batch 1: 开始训练
INFO:ubt_solution.model:品类倾向性: 437/2048 样本有标签 (21.34%)
INFO:ubt_solution.model:产品倾向性: 62/2048 样本有标签 (3.03%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3699519634246826
Training:  40%|████      | 2/5 [00:33<00:47, 15.96s/it]INFO:ubt_solution.trainer:Batch 2: 开始训练
INFO:ubt_solution.model:品类倾向性: 434/2048 样本有标签 (21.19%)
INFO:ubt_solution.model:产品倾向性: 54/2048 样本有标签 (2.64%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3683240413665771
Training:  60%|██████    | 3/5 [00:44<00:27, 13.53s/it]INFO:ubt_solution.trainer:Batch 3: 开始训练
INFO:ubt_solution.model:品类倾向性: 458/2048 样本有标签 (22.36%)
INFO:ubt_solution.model:产品倾向性: 50/2048 样本有标签 (2.44%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.366072654724121
Training:  80%|████████  | 4/5 [00:55<00:12, 12.55s/it]INFO:ubt_solution.trainer:Batch 4: 开始训练
INFO:ubt_solution.model:品类倾向性: 372/1808 样本有标签 (20.58%)
INFO:ubt_solution.model:产品倾向性: 50/1808 样本有标签 (2.77%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3642184734344482
Training: 100%|██████████| 5/5 [01:05<00:00, 11.73s/it]Training: 100%|██████████| 5/5 [01:06<00:00, 13.20s/it]
INFO:ubt_solution.trainer:total_loss: 13681.600261688232, total_samples: 10000
INFO:ubt_solution.trainer:Epoch average loss: 1.3682
INFO:ubt_solution.trainer:训练集 category_propensity 标签比例: 21.56%
INFO:ubt_solution.trainer:训练集 product_propensity 标签比例: 2.64%
INFO:ubt_solution.trainer:Epoch average churn_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average category_propensity_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average product_propensity_loss: 0.0000
Validation:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.model:品类倾向性: 580/2048 样本有标签 (28.32%)
INFO:ubt_solution.model:产品倾向性: 72/2048 样本有标签 (3.52%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  20%|██        | 1/5 [00:28<01:54, 28.53s/it]INFO:ubt_solution.model:品类倾向性: 605/2048 样本有标签 (29.54%)
INFO:ubt_solution.model:产品倾向性: 80/2048 样本有标签 (3.91%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  40%|████      | 2/5 [00:31<00:39, 13.29s/it]INFO:ubt_solution.model:品类倾向性: 423/2048 样本有标签 (20.65%)
INFO:ubt_solution.model:产品倾向性: 55/2048 样本有标签 (2.69%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  60%|██████    | 3/5 [00:33<00:16,  8.13s/it]INFO:ubt_solution.model:品类倾向性: 284/2048 样本有标签 (13.87%)
INFO:ubt_solution.model:产品倾向性: 22/2048 样本有标签 (1.07%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  80%|████████  | 4/5 [00:35<00:05,  5.68s/it]INFO:ubt_solution.model:品类倾向性: 264/1808 样本有标签 (14.60%)
INFO:ubt_solution.model:产品倾向性: 35/1808 样本有标签 (1.94%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation: 100%|██████████| 5/5 [00:37<00:00,  4.35s/it]Validation: 100%|██████████| 5/5 [00:37<00:00,  7.46s/it]
INFO:ubt_solution.trainer:churn_loss no improvement for 2 epochs
INFO:ubt_solution.trainer:category_propensity_loss no improvement for 2 epochs
INFO:ubt_solution.trainer:product_propensity_loss no improvement for 2 epochs
INFO:ubt_solution.trainer:New best churn_auc: 0.6530
INFO:ubt_solution.trainer:保存最佳模型，验证损失: 1.3569
INFO:ubt_solution.trainer:Validation metrics: {'val_loss': 1.3568919826507568, 'churn_loss': 0.0, 'category_propensity_loss': 0.0, 'product_propensity_loss': 0.0, 'churn_auc': 0.6530241966247559, 'category_propensity_accuracy': 0.5240538120269775, 'category_propensity_pos_accuracy': 0.5240538120269775, 'product_propensity_accuracy': 0.9862499833106995, 'product_propensity_pos_accuracy': 0.9862499833106995}
INFO:ubt_solution.trainer:category_propensity 标签比例: 当前=21.56%, 平均=21.56%
INFO:ubt_solution.trainer:product_propensity 标签比例: 当前=2.64%, 平均=2.64%
INFO:ubt_solution.trainer:Epoch 4/10
Training:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.trainer:Batch 0: 开始训练
INFO:ubt_solution.trainer:Batch 0: 品类倾向性标签比例 = 22.51%
INFO:ubt_solution.trainer:Batch 0: 产品倾向性标签比例 = 2.49%
INFO:ubt_solution.model:品类倾向性: 461/2048 样本有标签 (22.51%)
INFO:ubt_solution.model:产品倾向性: 51/2048 样本有标签 (2.49%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3622753620147705
Training:  20%|██        | 1/5 [00:31<02:07, 31.95s/it]INFO:ubt_solution.trainer:Batch 1: 开始训练
INFO:ubt_solution.model:品类倾向性: 438/2048 样本有标签 (21.39%)
INFO:ubt_solution.model:产品倾向性: 58/2048 样本有标签 (2.83%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3599153757095337
Training:  40%|████      | 2/5 [00:44<01:02, 20.75s/it]INFO:ubt_solution.trainer:Batch 2: 开始训练
INFO:ubt_solution.model:品类倾向性: 448/2048 样本有标签 (21.88%)
INFO:ubt_solution.model:产品倾向性: 64/2048 样本有标签 (3.12%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3586091995239258
Training:  60%|██████    | 3/5 [00:56<00:32, 16.40s/it]INFO:ubt_solution.trainer:Batch 3: 开始训练
INFO:ubt_solution.model:品类倾向性: 410/2048 样本有标签 (20.02%)
INFO:ubt_solution.model:产品倾向性: 44/2048 样本有标签 (2.15%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.355867624282837
Training:  80%|████████  | 4/5 [01:07<00:14, 14.29s/it]INFO:ubt_solution.trainer:Batch 4: 开始训练
INFO:ubt_solution.model:品类倾向性: 399/1808 样本有标签 (22.07%)
INFO:ubt_solution.model:产品倾向性: 47/1808 样本有标签 (2.60%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.353851079940796
Training: 100%|██████████| 5/5 [01:26<00:00, 16.09s/it]Training: 100%|██████████| 5/5 [01:26<00:00, 17.31s/it]
INFO:ubt_solution.trainer:total_loss: 13582.057918548584, total_samples: 10000
INFO:ubt_solution.trainer:Epoch average loss: 1.3582
INFO:ubt_solution.trainer:训练集 category_propensity 标签比例: 21.56%
INFO:ubt_solution.trainer:训练集 product_propensity 标签比例: 2.64%
INFO:ubt_solution.trainer:Epoch average churn_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average category_propensity_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average product_propensity_loss: 0.0000
Validation:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.model:品类倾向性: 580/2048 样本有标签 (28.32%)
INFO:ubt_solution.model:产品倾向性: 72/2048 样本有标签 (3.52%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  20%|██        | 1/5 [01:07<04:29, 67.36s/it]INFO:ubt_solution.model:品类倾向性: 605/2048 样本有标签 (29.54%)
INFO:ubt_solution.model:产品倾向性: 80/2048 样本有标签 (3.91%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  40%|████      | 2/5 [02:01<02:58, 59.42s/it]INFO:ubt_solution.model:品类倾向性: 423/2048 样本有标签 (20.65%)
INFO:ubt_solution.model:产品倾向性: 55/2048 样本有标签 (2.69%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  60%|██████    | 3/5 [02:40<01:40, 50.11s/it]INFO:ubt_solution.model:品类倾向性: 284/2048 样本有标签 (13.87%)
INFO:ubt_solution.model:产品倾向性: 22/2048 样本有标签 (1.07%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  80%|████████  | 4/5 [03:09<00:41, 41.71s/it]INFO:ubt_solution.model:品类倾向性: 264/1808 样本有标签 (14.60%)
INFO:ubt_solution.model:产品倾向性: 35/1808 样本有标签 (1.94%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation: 100%|██████████| 5/5 [03:33<00:00, 35.65s/it]Validation: 100%|██████████| 5/5 [03:34<00:00, 42.83s/it]
INFO:ubt_solution.trainer:churn_loss no improvement for 3 epochs
INFO:ubt_solution.trainer:category_propensity_loss no improvement for 3 epochs
INFO:ubt_solution.trainer:product_propensity_loss no improvement for 3 epochs
INFO:ubt_solution.trainer:New best churn_auc: 0.6543
INFO:ubt_solution.trainer:保存最佳模型，验证损失: 1.3447
INFO:ubt_solution.trainer:Validation metrics: {'val_loss': 1.3446515060424804, 'churn_loss': 0.0, 'category_propensity_loss': 0.0, 'product_propensity_loss': 0.0, 'churn_auc': 0.6542806029319763, 'category_propensity_accuracy': 0.48738405108451843, 'category_propensity_pos_accuracy': 0.48738405108451843, 'product_propensity_accuracy': 0.9862499833106995, 'product_propensity_pos_accuracy': 0.9862499833106995}
INFO:ubt_solution.trainer:category_propensity 标签比例: 当前=21.56%, 平均=21.56%
INFO:ubt_solution.trainer:product_propensity 标签比例: 当前=2.64%, 平均=2.64%
INFO:ubt_solution.trainer:Epoch 5/10
Training:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.trainer:Batch 0: 开始训练
INFO:ubt_solution.trainer:Batch 0: 品类倾向性标签比例 = 21.78%
INFO:ubt_solution.trainer:Batch 0: 产品倾向性标签比例 = 2.78%
INFO:ubt_solution.model:品类倾向性: 446/2048 样本有标签 (21.78%)
INFO:ubt_solution.model:产品倾向性: 57/2048 样本有标签 (2.78%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3514161109924316
Training:  20%|██        | 1/5 [01:22<05:30, 82.68s/it]INFO:ubt_solution.trainer:Batch 1: 开始训练
INFO:ubt_solution.model:品类倾向性: 421/2048 样本有标签 (20.56%)
INFO:ubt_solution.model:产品倾向性: 57/2048 样本有标签 (2.78%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3486342430114746
Training:  40%|████      | 2/5 [02:37<03:53, 77.94s/it]INFO:ubt_solution.trainer:Batch 2: 开始训练
INFO:ubt_solution.model:品类倾向性: 423/2048 样本有标签 (20.65%)
INFO:ubt_solution.model:产品倾向性: 49/2048 样本有标签 (2.39%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3468773365020752
Training:  60%|██████    | 3/5 [03:49<02:30, 75.42s/it]INFO:ubt_solution.trainer:Batch 3: 开始训练
INFO:ubt_solution.model:品类倾向性: 465/2048 样本有标签 (22.71%)
INFO:ubt_solution.model:产品倾向性: 53/2048 样本有标签 (2.59%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.3446142673492432
Training:  80%|████████  | 4/5 [05:04<01:15, 75.23s/it]INFO:ubt_solution.trainer:Batch 4: 开始训练
INFO:ubt_solution.model:品类倾向性: 401/1808 样本有标签 (22.18%)
INFO:ubt_solution.model:产品倾向性: 48/1808 样本有标签 (2.65%)
INFO:ubt_solution.model:1.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 1.341923713684082
Training: 100%|██████████| 5/5 [06:09<00:00, 71.33s/it]Training: 100%|██████████| 5/5 [06:09<00:00, 73.85s/it]
INFO:ubt_solution.trainer:total_loss: 13468.07600402832, total_samples: 10000
INFO:ubt_solution.trainer:Epoch average loss: 1.3468
INFO:ubt_solution.trainer:训练集 category_propensity 标签比例: 21.56%
INFO:ubt_solution.trainer:训练集 product_propensity 标签比例: 2.64%
INFO:ubt_solution.trainer:Epoch average churn_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average category_propensity_loss: 0.0000
INFO:ubt_solution.trainer:Epoch average product_propensity_loss: 0.0000
Validation:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.model:品类倾向性: 580/2048 样本有标签 (28.32%)
INFO:ubt_solution.model:产品倾向性: 72/2048 样本有标签 (3.52%)
INFO:ubt_solution.model:1.0,0.0,1.0
Validation:  20%|██        | 1/5 [01:08<04:34, 68.69s/it]
INFO:__main__:Using custom task weights: {'churn': 0.0, 'category_propensity': 0.0, 'product_propensity': 1.0}
INFO:ubt_solution.config:Using CUDA version: 11.8
INFO:ubt_solution.data_processor:内存使用情况 [初始化数据集开始] - RSS: 547.45 MB, VMS: 23751.63 MB
INFO:ubt_solution.data_processor:正在加载相关用户ID，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/input/relevant_clients.npy
INFO:ubt_solution.data_processor:测试模式：只处理前 10000 个用户
INFO:ubt_solution.data_processor:系统可用内存: 321.44 GB
INFO:ubt_solution.data_processor:根据系统内存自动设置块大小为: 20000
INFO:ubt_solution.data_processor:将用户分成 1 个块进行处理，每块大约 20000 个用户
INFO:ubt_solution.data_processor:内存使用情况 [开始分块加载事件数据] - RSS: 555.30 MB, VMS: 23759.26 MB
INFO:ubt_solution.data_processor:处理用户块 1/1
INFO:ubt_solution.data_processor:开始并行加载当前块的事件数据...
INFO:ubt_solution.data_processor:正在加载 product_buy 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/product_buy.parquet
INFO:ubt_solution.data_processor:正在加载 add_to_cart 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/add_to_cart.parquet
INFO:ubt_solution.data_processor:正在加载 remove_from_cart 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/remove_from_cart.parquet
INFO:ubt_solution.data_processor:正在加载 page_visit 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/page_visit.parquet
INFO:ubt_solution.data_processor:正在加载 search_query 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/search_query.parquet
INFO:ubt_solution.data_processor:product_buy 数据加载完成，形状: (44985, 4)
INFO:ubt_solution.data_processor:remove_from_cart 数据加载完成，形状: (39490, 4)
INFO:ubt_solution.data_processor:add_to_cart 数据加载完成，形状: (87008, 4)
INFO:ubt_solution.data_processor:search_query 数据加载完成，形状: (156434, 5)
INFO:ubt_solution.data_processor:page_visit 数据加载完成，形状: (1213783, 4)
INFO:ubt_solution.data_processor:内存使用情况 [块 1 事件数据加载完成] - RSS: 1312.93 MB, VMS: 26738.11 MB
INFO:ubt_solution.data_processor:开始加载商品属性数据...
INFO:ubt_solution.data_processor:正在加载商品属性数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/product_properties.parquet
INFO:ubt_solution.data_processor:商品属性数据加载完成，形状: (1197634, 4)
INFO:ubt_solution.data_processor:商品属性数据加载完成
INFO:ubt_solution.data_processor:开始构建用户块 1 的序列...
INFO:ubt_solution.data_processor:开始构建用户序列...
INFO:ubt_solution.data_processor:内存使用情况 [开始构建用户序列] - RSS: 1539.78 MB, VMS: 26912.97 MB
INFO:ubt_solution.data_processor:找到缓存文件 /data/mhwang/Rec/RecSys/recsys2025/ubt_solution/ubt_solution/cache/user_sequences_479641934112442117.pkl，尝试加载...
INFO:ubt_solution.data_processor:成功从缓存加载 10000 个用户序列
INFO:ubt_solution.data_processor:块 1 处理完成，耗时: 92.74 秒
INFO:ubt_solution.data_processor:内存使用情况 [块 1 处理完成] - RSS: 1755.93 MB, VMS: 27124.97 MB
INFO:ubt_solution.data_processor:用户序列构建完成，共 10000 个用户
INFO:ubt_solution.data_processor:创建商品属性查找字典...
INFO:ubt_solution.data_processor:商品属性字典创建完成，包含 1197634 个商品
INFO:ubt_solution.data_processor:设置样本缓存大小为 5000
INFO:ubt_solution.data_processor:内存使用情况 [数据集初始化完成] - RSS: 2123.00 MB, VMS: 27479.89 MB
INFO:ubt_solution.data_processor:内存使用情况 [初始化数据集开始] - RSS: 2123.00 MB, VMS: 27479.89 MB
INFO:ubt_solution.data_processor:正在加载相关用户ID，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/input/relevant_clients.npy
INFO:ubt_solution.data_processor:测试模式：只处理前 10000 个用户
INFO:ubt_solution.data_processor:系统可用内存: 320.01 GB
INFO:ubt_solution.data_processor:根据系统内存自动设置块大小为: 20000
INFO:ubt_solution.data_processor:将用户分成 1 个块进行处理，每块大约 20000 个用户
INFO:ubt_solution.data_processor:内存使用情况 [开始分块加载事件数据] - RSS: 2130.28 MB, VMS: 27487.52 MB
INFO:ubt_solution.data_processor:处理用户块 1/1
INFO:ubt_solution.data_processor:开始并行加载当前块的事件数据...
INFO:ubt_solution.data_processor:正在加载 product_buy 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/product_buy.parquet
INFO:ubt_solution.data_processor:正在加载 add_to_cart 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/add_to_cart.parquet
INFO:ubt_solution.data_processor:正在加载 remove_from_cart 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/remove_from_cart.parquet
INFO:ubt_solution.data_processor:正在加载 page_visit 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/page_visit.parquet
INFO:ubt_solution.data_processor:正在加载 search_query 数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/search_query.parquet
INFO:ubt_solution.data_processor:product_buy 数据加载完成，形状: (44985, 4)
INFO:ubt_solution.data_processor:remove_from_cart 数据加载完成，形状: (39490, 4)
INFO:ubt_solution.data_processor:add_to_cart 数据加载完成，形状: (87008, 4)
INFO:ubt_solution.data_processor:search_query 数据加载完成，形状: (156434, 5)
INFO:ubt_solution.data_processor:page_visit 数据加载完成，形状: (1213783, 4)
INFO:ubt_solution.data_processor:内存使用情况 [块 1 事件数据加载完成] - RSS: 2348.62 MB, VMS: 28183.57 MB
INFO:ubt_solution.data_processor:开始加载商品属性数据...
INFO:ubt_solution.data_processor:正在加载商品属性数据，文件路径: /data/mhwang/Rec/RecSys/recsys2025/data/product_properties.parquet
INFO:ubt_solution.data_processor:商品属性数据加载完成，形状: (1197634, 4)
INFO:ubt_solution.data_processor:商品属性数据加载完成
INFO:ubt_solution.data_processor:开始构建用户块 1 的序列...
INFO:ubt_solution.data_processor:开始构建用户序列...
INFO:ubt_solution.data_processor:内存使用情况 [开始构建用户序列] - RSS: 2501.03 MB, VMS: 28374.23 MB
INFO:ubt_solution.data_processor:找到缓存文件 /data/mhwang/Rec/RecSys/recsys2025/ubt_solution/ubt_solution/cache/user_sequences_479641934112442117.pkl，尝试加载...
INFO:ubt_solution.data_processor:成功从缓存加载 10000 个用户序列
INFO:ubt_solution.data_processor:块 1 处理完成，耗时: 92.28 秒
INFO:ubt_solution.data_processor:内存使用情况 [块 1 处理完成] - RSS: 2717.37 MB, VMS: 28582.23 MB
INFO:ubt_solution.data_processor:用户序列构建完成，共 10000 个用户
INFO:ubt_solution.data_processor:创建商品属性查找字典...
INFO:ubt_solution.data_processor:商品属性字典创建完成，包含 1197634 个商品
INFO:ubt_solution.data_processor:设置样本缓存大小为 5000
INFO:ubt_solution.data_processor:内存使用情况 [数据集初始化完成] - RSS: 3132.58 MB, VMS: 28962.52 MB
/data_sdc/mhwang/miniconda3/envs/RecSys/lib/python3.11/site-packages/torch/nn/modules/transformer.py:379: UserWarning: enable_nested_tensor is True, but self.use_nested_tensor is False because encoder_layer.norm_first was True
  warnings.warn(
/data_sdc/mhwang/miniconda3/envs/RecSys/lib/python3.11/site-packages/torch/optim/lr_scheduler.py:62: UserWarning: The verbose parameter is deprecated. Please use get_last_lr() to access the learning rate.
  warnings.warn(
INFO:__main__:开始训练模型...
INFO:ubt_solution.trainer:Epoch 1/10
Training:   0%|          | 0/5 [00:00<?, ?it/s]INFO:ubt_solution.trainer:Batch 0: 开始训练
INFO:ubt_solution.trainer:Batch 0: 品类倾向性标签比例 = 22.12%
INFO:ubt_solution.trainer:Batch 0: 产品倾向性标签比例 = 2.73%
INFO:ubt_solution.model:品类倾向性: 453/2048 样本有标签 (22.12%)
INFO:ubt_solution.model:产品倾向性: 56/2048 样本有标签 (2.73%)
INFO:ubt_solution.model:0.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 0.6931427121162415
Training:  20%|██        | 1/5 [00:23<01:32, 23.23s/it]INFO:ubt_solution.trainer:Batch 1: 开始训练
INFO:ubt_solution.model:品类倾向性: 459/2048 样本有标签 (22.41%)
INFO:ubt_solution.model:产品倾向性: 65/2048 样本有标签 (3.17%)
INFO:ubt_solution.model:0.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 0.691984236240387
Training:  40%|████      | 2/5 [00:33<00:47, 15.86s/it]INFO:ubt_solution.trainer:Batch 2: 开始训练
INFO:ubt_solution.model:品类倾向性: 409/2048 样本有标签 (19.97%)
INFO:ubt_solution.model:产品倾向性: 47/2048 样本有标签 (2.29%)
INFO:ubt_solution.model:0.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 0.6908403038978577
Training:  60%|██████    | 3/5 [00:44<00:27, 13.51s/it]INFO:ubt_solution.trainer:Batch 3: 开始训练
INFO:ubt_solution.model:品类倾向性: 450/2048 样本有标签 (21.97%)
INFO:ubt_solution.model:产品倾向性: 41/2048 样本有标签 (2.00%)
INFO:ubt_solution.model:0.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 0.6896790862083435
Training:  80%|████████  | 4/5 [00:55<00:12, 12.38s/it]INFO:ubt_solution.trainer:Batch 4: 开始训练
INFO:ubt_solution.model:品类倾向性: 385/1808 样本有标签 (21.29%)
INFO:ubt_solution.model:产品倾向性: 55/1808 样本有标签 (3.04%)
INFO:ubt_solution.model:0.0,0.0,1.0
INFO:ubt_solution.trainer:loss: 0.6884922981262207
